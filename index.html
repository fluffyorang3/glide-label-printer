<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Auto-Print Label</title>
    <!-- QZ Tray client (must be HTTPS to match GitHub Pages) -->
    <script src="qz-tray.js"></script>
    <style>
      /* 10×7 cm label, bold labels */
      @page {
        size: 10cm 7cm;
        margin: 0;
      }
      body {
        margin: 0;
        padding: 0;
        font-family: sans-serif;
        font-size: 12px;
        font-weight: bold;
      }
      .container {
        position: relative;
        width: 10cm;
        height: 7cm;
        display: flex;
        box-sizing: border-box;
        overflow: hidden;
      }
      .container::before {
        content: "";
        position: absolute;
        top: 0.05cm;
        left: 0.05cm;
        right: 0.05cm;
        bottom: 0.05cm;
        border: 0.1cm solid #000;
        box-sizing: border-box;
        pointer-events: none;
        z-index: 10;
      }
      .left {
        width: 5cm;
        height: 7cm;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
        z-index: 1;
        margin-left: 0;
      }
      #logo {
        max-width: 4.5cm;
        max-height: 1.5cm;
        margin-top: 0.2cm;
        z-index: 1;
      }
      #qr {
        width: 5cm;
        height: 5cm;
        margin-top: 0.2cm;
        z-index: 1;
      }
      .right {
        flex: 1;
        padding: 0.4cm;
        display: flex;
        flex-direction: column;
        justify-content: space-around;
        font-size: 12px;
        z-index: 1;
      }
      .right .label {
        font-weight: normal;
        font-size: 16px;
        margin-bottom: 0.1cm;
      }
      .right .value {
        font-weight: bold;
        font-size: 16px;
        margin-bottom: 0.3cm;
      }
    </style>
  </head>
  <body>
    <div id="content" class="container">
      <div class="left">
        <img id="logo" src="benian_logo.png" alt="Logo" />
        <img id="qr" src="" alt="QR code" />
      </div>
      <div class="right">
        <div>
          <div class="label">Client:</div>
          <div class="value" id="client"></div>
        </div>
        <div>
          <div class="label">City:</div>
          <div class="value" id="city"></div>
        </div>
        <div>
          <div class="label">Date:</div>
          <div class="value" id="date"></div>
        </div>
      </div>
    </div>

    <script>
      qz.security.setCertificatePromise((resolve) => {
        resolve(`-----BEGIN CERTIFICATE-----
MIIECzCCAvOgAwIBAgIGAZZy4bTfMA0GCSqGSIb3DQEBCwUAMIGiMQswCQYDVQQG
EwJVUzELMAkGA1UECAwCTlkxEjAQBgNVBAcMCUNhbmFzdG90YTEbMBkGA1UECgwS
UVogSW5kdXN0cmllcywgTExDMRswGQYDVQQLDBJRWiBJbmR1c3RyaWVzLCBMTEMx
HDAaBgkqhkiG9w0BCQEWDXN1cHBvcnRAcXouaW8xGjAYBgNVBAMMEVFaIFRyYXkg
RGVtbyBDZXJ0MB4XDTI1MDQyNTE2MTUxNloXDTQ1MDQyNTE2MTUxNlowgaIxCzAJ
BgNVBAYTAlVTMQswCQYDVQQIDAJOWTESMBAGA1UEBwwJQ2FuYXN0b3RhMRswGQYD
VQQKDBJRWiBJbmR1c3RyaWVzLCBMTEMxGzAZBgNVBAsMElFaIEluZHVzdHJpZXMs
IExMQzEcMBoGCSqGSIb3DQEJARYNc3VwcG9ydEBxei5pbzEaMBgGA1UEAwwRUVog
VHJheSBEZW1vIENlcnQwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDA
Knx++Xk9aNTL66EV0+DfrvCVJGG7QCRrnZb39BaMrZc4ZQeKHLvLWiZqUUjIGu56
edyy/baICtUBRAUBgEgd+exPJHMKD2s6D1swoc2EF04b9m798QsefV6zCy33GpWC
Oq3alu1S2gA9tcPKtNuxMg21rDl2YAGk5f59tuTMi5hx20VKHuDutOS48EsxdsWp
Uz4MBSnQnxYtuBMi8fLHSGIT/tNNxn17jzzW8+GYZqKttADUel5yw4CZNvfb6t30
hr9LI5PRg0tevxmEb5xHQ+jw4mKDIxjaAH6vUhJD7iwWB/2WsOYvtIOH44x0lmxn
mH7xAVMavfNlgOuJHIYxAgMBAAGjRTBDMBIGA1UdEwEB/wQIMAYBAf8CAQEwDgYD
VR0PAQH/BAQDAgEGMB0GA1UdDgQWBBS6+X2EiwrsQQqdCZEZzFgL3IB+sDANBgkq
hkiG9w0BAQsFAAOCAQEArgl8zAKN7Gz6TyKXpMBZ7vKHsMbV51pPI1YRsTHwwENL
w+0g8qmCPLn2aD6e0zBlmZGqAIMGrmme+xA/LSxyLKZxZWB3QoPzVejfUUTgxSJ3
gCNd91/xZTBdGuNi86inC2XJiuDvMht3NRDcKa+ldwsWvl08sOjy3K2oT0XBPWd4
pklvwnOjuOe5ZBnmQD9mXgPKCCu6f2ys8K50VJIVqllwgClhxNCah0CUUOU0pTvW
tP8BXDifN8/kTGGEwWDgRbvHvBsaWwtO8+zuhLdKdtO/sOgigpVd3f7rii/c/u3Y
FB86TJ/VMJr+ZwD9HhyJU6vrDAQ3UJR0zQGcvOZq9g==
-----END CERTIFICATE-----`);
      });

      qz.security.setSignaturePromise((toSign) => qz.tools.sign(toSign));

      window.addEventListener("load", async () => {
        // 1) Populate fields from URL
        const params = new URLSearchParams(window.location.search);
        document.getElementById("qr").src = params.get("qr") || "";
        document.getElementById("client").textContent =
          params.get("client") || "";
        document.getElementById("city").textContent = params.get("city") || "";
        document.getElementById("date").textContent = params.get("date") || "";

        try {
          // 2) Connect to QZ Tray
          await qz.websocket.connect();

          // 3) Find the RP410
          const printer = await qz.printers.find("RP4xx Series 200DPI TSC");

          // 4) Print the container’s HTML directly
          const htmlContent = document.getElementById("content").outerHTML;
          await qz.print(printer, [
            {
              type: "html",
              format: "plain",
              data: htmlContent,
            },
          ]);

          // 5) Disconnect when done
          await qz.websocket.disconnect();
        } catch (e) {
          console.error("Auto-print failed:", e);
        }
      });
    </script>
  </body>
</html>
